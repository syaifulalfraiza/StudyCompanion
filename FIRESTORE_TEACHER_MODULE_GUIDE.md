# Firestore Database Configuration - Teacher Module

## ğŸ“Š Overview

This guide provides complete Firestore database configuration for the **Teacher Module** of StudyCompanion app. It includes all collections, documents, fields, and setup instructions.

---

## ğŸ—‚ï¸ Collections Structure

The Teacher Module uses **6 main collections**:

```
firestore (root)
â”œâ”€â”€ users
â”œâ”€â”€ teachers
â”œâ”€â”€ classes
â”œâ”€â”€ assignments
â”œâ”€â”€ grades
â””â”€â”€ announcements
```

---

## 1ï¸âƒ£ Users Collection

**Collection Name:** `users`

**Purpose:** Store all user accounts (students, parents, teachers, admins) for authentication and basic profile info.

### Document Structure

**Document ID:** Auto-generated by Firebase Auth (UID) or custom ID (e.g., `t1`, `t2`, `s1`, etc.)

### Fields

| Field Name | Data Type | Required | Description | Example |
|------------|-----------|----------|-------------|---------|
| `userId` | String | âœ… Yes | Unique identifier (same as document ID) | `"t1"` |
| `name` | String | âœ… Yes | Full name of user | `"Cikgu Ahmad"` |
| `email` | String | âœ… Yes | Login email address | `"ahmad@school.edu.my"` |
| `password` | String | âš ï¸ No* | Stored only in Firebase Auth, not Firestore | - |
| `role` | String | âœ… Yes | User role: `student`, `parent`, `teacher`, `admin` | `"teacher"` |
| `phone` | String | ğŸ”µ Optional | Contact phone number | `"012-3456789"` |
| `createdAt` | Timestamp | âœ… Yes | Account creation timestamp | `2026-01-15T10:30:00Z` |
| `lastLogin` | Timestamp | ğŸ”µ Optional | Last login timestamp | `2026-02-11T08:15:00Z` |
| `isActive` | Boolean | âœ… Yes | Account status | `true` |

> **âš ï¸ Security Note:** Passwords are managed by **Firebase Authentication**, NOT stored in Firestore.

### Sample Document (Teacher)

```json
{
  "userId": "t1",
  "name": "Cikgu Ahmad",
  "email": "ahmad@school.edu.my",
  "role": "teacher",
  "phone": "012-3456789",
  "createdAt": "2026-01-15T10:30:00.000Z",
  "lastLogin": "2026-02-11T08:15:00.000Z",
  "isActive": true
}
```

---

## 2ï¸âƒ£ Teachers Collection

**Collection Name:** `teachers`

**Purpose:** Store detailed teacher profiles, qualifications, and teaching information.

### Document Structure

**Document ID:** Teacher's unique ID (e.g., `t1`, `t2`) - same as `userId` in `users` collection

### Fields

| Field Name | Data Type | Required | Description | Example |
|------------|-----------|----------|-------------|---------|
| `teacherId` | String | âœ… Yes | Teacher ID (same as document ID) | `"t1"` |
| `name` | String | âœ… Yes | Teacher's full name | `"Cikgu Ahmad"` |
| `email` | String | âœ… Yes | Teacher's email | `"ahmad@school.edu.my"` |
| `phone` | String | âœ… Yes | Contact number | `"012-3456789"` |
| `subject` | String | âœ… Yes | Primary subject taught | `"Mathematics"` |
| `qualification` | String | âœ… Yes | Highest qualification | `"Degree in Mathematics"` |
| `yearsExperience` | Number | âœ… Yes | Years of teaching experience | `8` |
| `classIds` | Array | ğŸ”µ Optional | List of class IDs taught | `["c1", "c2"]` |
| `department` | String | ğŸ”µ Optional | Department name | `"Science & Mathematics"` |
| `officeRoom` | String | ğŸ”µ Optional | Office location | `"Room 201"` |
| `employeeId` | String | ğŸ”µ Optional | School employee ID | `"EMP2018001"` |
| `joinDate` | Timestamp | ğŸ”µ Optional | Date joined school | `2018-06-01T00:00:00Z` |

### Sample Document

```json
{
  "teacherId": "t1",
  "name": "Cikgu Ahmad",
  "email": "ahmad@school.edu.my",
  "phone": "012-3456789",
  "subject": "Mathematics",
  "qualification": "Degree in Mathematics",
  "yearsExperience": 8,
  "classIds": ["c1", "c2"],
  "department": "Science & Mathematics",
  "officeRoom": "Room 201",
  "employeeId": "EMP2018001",
  "joinDate": "2018-06-01T00:00:00.000Z"
}
```

---

## 3ï¸âƒ£ Classes Collection

**Collection Name:** `classes`

**Purpose:** Store class/section information taught by teachers.

### Document Structure

**Document ID:** Auto-generated or custom (e.g., `c1`, `c2`, `c3`)

### Fields

| Field Name | Data Type | Required | Description | Example |
|------------|-----------|----------|-------------|---------|
| `classId` | String | âœ… Yes | Class ID (same as document ID) | `"c1"` |
| `name` | String | âœ… Yes | Class full name | `"Form 4 Mathematics A"` |
| `section` | String | âœ… Yes | Class section identifier | `"4A"` |
| `teacherId` | String | âœ… Yes | Teacher assigned to class | `"t1"` |
| `subject` | String | âœ… Yes | Subject taught | `"Mathematics"` |
| `studentCount` | Number | âœ… Yes | Number of students enrolled | `35` |
| `semester` | String | âœ… Yes | Current semester | `"First Semester 2026"` |
| `academicYear` | String | âœ… Yes | Academic year | `"2026"` |
| `studentIds` | Array | ğŸ”µ Optional | List of enrolled student IDs | `["s1", "s2", "s3"]` |
| `schedule` | Map | ğŸ”µ Optional | Class timetable | `{"monday": ["8:00-9:00"], "wednesday": ["10:00-11:00"]}` |
| `room` | String | ğŸ”µ Optional | Classroom location | `"Lab 3A"` |

### Sample Document

```json
{
  "classId": "c1",
  "name": "Form 4 Mathematics A",
  "section": "4A",
  "teacherId": "t1",
  "subject": "Mathematics",
  "studentCount": 35,
  "semester": "First Semester 2026",
  "academicYear": "2026",
  "studentIds": ["s1", "s2", "s3", "..."],
  "schedule": {
    "monday": ["8:00-9:00"],
    "wednesday": ["10:00-11:00"],
    "friday": ["9:00-10:00"]
  },
  "room": "Room 305"
}
```

---

## 4ï¸âƒ£ Assignments Collection

**Collection Name:** `assignments`

**Purpose:** Store assignments/tasks created by teachers.

### Document Structure

**Document ID:** Auto-generated or custom (e.g., `a1`, `a2`, `a3`)

### Fields

| Field Name | Data Type | Required | Description | Example |
|------------|-----------|----------|-------------|---------|
| `assignmentId` | String | âœ… Yes | Assignment ID (same as document ID) | `"a1"` |
| `title` | String | âœ… Yes | Assignment title | `"Chapter 4 Review - Algebra"` |
| `description` | String | âœ… Yes | Detailed instructions | `"Complete all practice problems from Chapter 4."` |
| `classId` | String | âœ… Yes | Class this assignment is for | `"c1"` |
| `teacherId` | String | âœ… Yes | Teacher who created it | `"t1"` |
| `subject` | String | âœ… Yes | Subject area | `"Mathematics"` |
| `dueDate` | Timestamp | âœ… Yes | Submission deadline | `2026-02-14T23:59:59Z` |
| `createdDate` | Timestamp | âœ… Yes | Date assignment was created | `2026-02-08T10:00:00Z` |
| `submittedCount` | Number | âœ… Yes | Number of students who submitted | `28` |
| `totalStudents` | Number | âœ… Yes | Total students in class | `35` |
| `isPublished` | Boolean | âœ… Yes | Published status (visible to students) | `true` |
| `maxScore` | Number | ğŸ”µ Optional | Maximum possible score | `100` |
| `attachments` | Array | ğŸ”µ Optional | File URLs or references | `["gs://bucket/file1.pdf"]` |
| `rubric` | Map | ğŸ”µ Optional | Grading rubric | `{"criteria1": 40, "criteria2": 60}` |

### Sample Document

```json
{
  "assignmentId": "a1",
  "title": "Chapter 4 Review - Algebra",
  "description": "Complete all practice problems from Chapter 4. Focus on quadratic equations.",
  "classId": "c1",
  "teacherId": "t1",
  "subject": "Mathematics",
  "dueDate": "2026-02-14T23:59:59.000Z",
  "createdDate": "2026-02-08T10:00:00.000Z",
  "submittedCount": 28,
  "totalStudents": 35,
  "isPublished": true,
  "maxScore": 100,
  "attachments": [],
  "rubric": {
    "accuracy": 40,
    "workShown": 30,
    "presentation": 30
  }
}
```

---

## 5ï¸âƒ£ Grades Collection

**Collection Name:** `grades`

**Purpose:** Store student grades recorded by teachers for assignments.

### Document Structure

**Document ID:** Auto-generated or composite key (e.g., `a1_s1`, `a2_s3`)

### Fields

| Field Name | Data Type | Required | Description | Example |
|------------|-----------|----------|-------------|---------|
| `gradeId` | String | âœ… Yes | Grade record ID | `"g1"` |
| `studentId` | String | âœ… Yes | Student who received grade | `"s1"` |
| `assignmentId` | String | âœ… Yes | Assignment graded | `"a1"` |
| `classId` | String | âœ… Yes | Class reference | `"c1"` |
| `teacherId` | String | âœ… Yes | Teacher who graded | `"t1"` |
| `score` | Number | âœ… Yes | Points earned | `85` |
| `maxScore` | Number | âœ… Yes | Maximum possible score | `100` |
| `grade` | String | âœ… Yes | Letter grade | `"A"` |
| `feedback` | String | ğŸ”µ Optional | Teacher's feedback | `"Excellent work! Keep it up."` |
| `recordedDate` | Timestamp | âœ… Yes | When grade was recorded | `2026-02-15T14:30:00Z` |
| `rubricNotes` | String | ğŸ”µ Optional | Detailed rubric breakdown | `"Accuracy: 38/40, Work: 28/30, Presentation: 29/30"` |
| `submissionUrl` | String | ğŸ”µ Optional | Link to student's submission | `"gs://bucket/submissions/s1_a1.pdf"` |

### Sample Document

```json
{
  "gradeId": "g1",
  "studentId": "s1",
  "assignmentId": "a1",
  "classId": "c1",
  "teacherId": "t1",
  "score": 85,
  "maxScore": 100,
  "grade": "A",
  "feedback": "Excellent work! Keep it up.",
  "recordedDate": "2026-02-15T14:30:00.000Z",
  "rubricNotes": "Accuracy: 38/40, Work: 28/30, Presentation: 29/30",
  "submissionUrl": null
}
```

### Grade Calculation

```dart
// Percentage
double percentage = (score / maxScore) * 100;

// Letter Grade
String calculateGrade(double percentage) {
  if (percentage >= 90) return 'A';
  if (percentage >= 80) return 'B';
  if (percentage >= 70) return 'C';
  if (percentage >= 60) return 'D';
  return 'F';
}
```

---

## 6ï¸âƒ£ Announcements Collection

**Collection Name:** `announcements`

**Purpose:** Store announcements created by teachers for students/parents.

### Document Structure

**Document ID:** Auto-generated or custom (e.g., `ann1`, `ann2`)

### Fields

| Field Name | Data Type | Required | Description | Example |
|------------|-----------|----------|-------------|---------|
| `announcementId` | String | âœ… Yes | Announcement ID | `"ann1"` |
| `title` | String | âœ… Yes | Announcement title | `"Upcoming Mathematics Test"` |
| `message` | String | âœ… Yes | Full announcement message | `"The test will cover Chapters 3-4."` |
| `createdBy` | String | âœ… Yes | Teacher ID who created it | `"t1"` |
| `date` | Timestamp | âœ… Yes | Date posted | `2026-02-10T09:00:00Z` |
| `isPublished` | Boolean | âœ… Yes | Published status (true) or Draft (false) | `true` |
| `classIds` | Array | ğŸ”µ Optional | Classes this applies to | `["c1", "c2"]` |
| `priority` | String | ğŸ”µ Optional | Priority level | `"high"`, `"medium"`, `"low"` |
| `expiryDate` | Timestamp | ğŸ”µ Optional | When announcement expires | `2026-02-20T23:59:59Z` |
| `attachments` | Array | ğŸ”µ Optional | File attachments | `["gs://bucket/notice.pdf"]` |

### Sample Document

```json
{
  "announcementId": "ann1",
  "title": "Upcoming Mathematics Test",
  "message": "The test will cover Chapters 3-4. Please review your notes and practice problems. Good luck!",
  "createdBy": "t1",
  "date": "2026-02-10T09:00:00.000Z",
  "isPublished": true,
  "classIds": ["c1", "c2"],
  "priority": "high",
  "expiryDate": "2026-02-20T23:59:59.000Z",
  "attachments": []
}
```

---

## ğŸ” Firestore Security Rules

### Recommended Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is authenticated
    function isSignedIn() {
      return request.auth != null;
    }
    
    // Helper function to get user role
    function getUserRole() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role;
    }
    
    // Users collection
    match /users/{userId} {
      allow read: if isSignedIn();
      allow write: if isSignedIn() && request.auth.uid == userId;
    }
    
    // Teachers collection
    match /teachers/{teacherId} {
      allow read: if isSignedIn();
      allow write: if isSignedIn() && getUserRole() == 'teacher' && request.auth.uid == teacherId;
      allow write: if isSignedIn() && getUserRole() == 'admin';
    }
    
    // Classes collection
    match /classes/{classId} {
      allow read: if isSignedIn();
      allow write: if isSignedIn() && getUserRole() in ['teacher', 'admin'];
    }
    
    // Assignments collection
    match /assignments/{assignmentId} {
      allow read: if isSignedIn();
      allow create: if isSignedIn() && getUserRole() == 'teacher';
      allow update, delete: if isSignedIn() && getUserRole() == 'teacher' && resource.data.teacherId == request.auth.uid;
      allow write: if isSignedIn() && getUserRole() == 'admin';
    }
    
    // Grades collection
    match /grades/{gradeId} {
      allow read: if isSignedIn();
      allow create: if isSignedIn() && getUserRole() == 'teacher';
      allow update, delete: if isSignedIn() && getUserRole() == 'teacher' && resource.data.teacherId == request.auth.uid;
      allow write: if isSignedIn() && getUserRole() == 'admin';
    }
    
    // Announcements collection
    match /announcements/{announcementId} {
      allow read: if isSignedIn();
      allow create: if isSignedIn() && getUserRole() == 'teacher';
      allow update, delete: if isSignedIn() && getUserRole() == 'teacher' && resource.data.createdBy == request.auth.uid;
      allow write: if isSignedIn() && getUserRole() == 'admin';
    }
  }
}
```

---

## ğŸ“‘ Composite Indexes

### Required Indexes for Teacher Module

Add these in Firebase Console â†’ Firestore â†’ Indexes:

#### 1. Assignments by Teacher & Class
```
Collection: assignments
Fields:
  - teacherId (Ascending)
  - classId (Ascending)
  - dueDate (Descending)
```

#### 2. Grades by Assignment
```
Collection: grades
Fields:
  - assignmentId (Ascending)
  - studentId (Ascending)
```

#### 3. Grades by Student
```
Collection: grades
Fields:
  - studentId (Ascending)
  - assignmentId (Ascending)
  - recordedDate (Descending)
```

#### 4. Announcements by Teacher & Status
```
Collection: announcements
Fields:
  - createdBy (Ascending)
  - isPublished (Ascending)
  - date (Descending)
```

#### 5. Classes by Teacher
```
Collection: classes
Fields:
  - teacherId (Ascending)
  - academicYear (Descending)
  - semester (Ascending)
```

---

## ğŸš€ Firestore Setup Instructions

### Step 1: Enable Firestore

1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Select your project (or create new)
3. Navigate to **Build** â†’ **Firestore Database**
4. Click **Create Database**
5. Choose **Start in test mode** (for development)
6. Select your preferred **Cloud Firestore location** (e.g., `asia-southeast1` for Malaysia)

### Step 2: Create Collections

You can create collections in two ways:

#### Option A: Via Firebase Console (Manual)
1. Go to Firestore Database
2. Click **Start collection**
3. Enter collection ID (e.g., `users`)
4. Add first document with sample data
5. Repeat for all 6 collections

#### Option B: Via Flutter App (Programmatic)
Collections are auto-created when you add first document from your app.

### Step 3: Add Initial Data

#### Create Admin User (via Firebase Console)

1. Go to **Authentication** â†’ **Users** â†’ **Add user**
   - Email: `admin@school.edu.my`
   - Password: `admin123` (change after first login)

2. Go to **Firestore** â†’ **users** collection â†’ **Add document**
```json
{
  "userId": "admin1",
  "name": "System Admin",
  "email": "admin@school.edu.my",
  "role": "admin",
  "phone": "012-0000000",
  "createdAt": [Current timestamp],
  "isActive": true
}
```

#### Create Sample Teachers (Copy from sample_teacher_data.dart)

**Teacher 1:**
```json
{
  "teacherId": "t1",
  "name": "Cikgu Ahmad",
  "email": "ahmad@school.edu.my",
  "phone": "012-3456789",
  "subject": "Mathematics",
  "qualification": "Degree in Mathematics",
  "yearsExperience": 8
}
```

Add documents for `t2` through `t6` following the sample data.

### Step 4: Set Up Security Rules

1. Go to **Firestore** â†’ **Rules** tab
2. Replace default rules with the security rules above
3. Click **Publish**

### Step 5: Create Indexes

1. Go to **Firestore** â†’ **Indexes** tab
2. Click **Create Index**
3. Add each composite index listed above
4. Wait for indexes to build (can take a few minutes)

### Step 6: Test Connection from App

Add to your Flutter app:

```dart
// Test Firestore connection
Future<void> testFirestoreConnection() async {
  try {
    // Read teachers collection
    final snapshot = await FirebaseFirestore.instance
        .collection('teachers')
        .limit(1)
        .get();
    
    print('âœ… Firestore connected! Found ${snapshot.docs.length} documents');
  } catch (e) {
    print('âŒ Firestore error: $e');
  }
}
```

---

## ğŸ“Š Data Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Users     â”‚
â”‚  (Auth +    â”‚
â”‚   Profile)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Teachers   â”‚  â”‚  Students   â”‚
â”‚  (Details)  â”‚  â”‚  (Details)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â”‚                â”‚
       â–¼                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   Classes   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (Sections) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Assignments â”‚ â”‚   Grades    â”‚ â”‚Announcements â”‚
â”‚  (Tasks)    â”‚ â”‚  (Results)  â”‚ â”‚  (Notices)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Common Firestore Queries for Teacher Module

### 1. Get Teacher's Classes
```dart
final snapshot = await FirebaseFirestore.instance
    .collection('classes')
    .where('teacherId', isEqualTo: 't1')
    .get();
```

### 2. Get Assignments for a Class
```dart
final snapshot = await FirebaseFirestore.instance
    .collection('assignments')
    .where('classId', isEqualTo: 'c1')
    .orderBy('dueDate', descending: true)
    .get();
```

### 3. Get Grades for an Assignment
```dart
final snapshot = await FirebaseFirestore.instance
    .collection('grades')
    .where('assignmentId', isEqualTo: 'a1')
    .get();
```

### 4. Get Published Announcements by Teacher
```dart
final snapshot = await FirebaseFirestore.instance
    .collection('announcements')
    .where('createdBy', isEqualTo: 't1')
    .where('isPublished', isEqualTo: true)
    .orderBy('date', descending: true)
    .get();
```

### 5. Record a New Grade
```dart
await FirebaseFirestore.instance
    .collection('grades')
    .add({
      'studentId': 's1',
      'assignmentId': 'a1',
      'classId': 'c1',
      'teacherId': 't1',
      'score': 85,
      'maxScore': 100,
      'grade': 'A',
      'feedback': 'Great job!',
      'recordedDate': FieldValue.serverTimestamp(),
    });
```

---

## ğŸ“ Migration from Sample Data to Firestore

If you're migrating from `SampleTeacherData` to Firestore:

### Migration Script (example)

```dart
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:studycompanion_app/services/sample_teacher_data.dart';

Future<void> migrateSampleDataToFirestore() async {
  final firestore = FirebaseFirestore.instance;
  
  // 1. Migrate Teachers
  final teachers = SampleTeacherData.getAllTeachers();
  for (var teacher in teachers) {
    await firestore.collection('teachers').doc(teacher['id']).set({
      'teacherId': teacher['id'],
      'name': teacher['name'],
      'email': teacher['email'],
      'phone': teacher['phone'],
      'subject': teacher['subject'],
      'qualification': teacher['qualification'],
      'yearsExperience': teacher['yearsExperience'],
    });
  }
  
  // 2. Migrate Classes
  for (var teacherId in ['t1', 't2', 't3', 't4', 't5', 't6']) {
    final classes = SampleTeacherData.getClasses(teacherId);
    for (var classModel in classes) {
      await firestore.collection('classes').doc(classModel.id).set(
        classModel.toJson(),
      );
    }
  }
  
  // 3. Migrate Assignments
  for (var teacherId in ['t1', 't2', 't3', 't4', 't5', 't6']) {
    final assignments = SampleTeacherData.getAssignments(teacherId);
    for (var assignment in assignments) {
      await firestore.collection('assignments').doc(assignment.id).set(
        assignment.toJson(),
      );
    }
  }
  
  // 4. Migrate Announcements
  for (var teacherId in ['t1', 't2', 't3', 't4', 't5', 't6']) {
    final announcements = SampleTeacherData.getAnnouncements(teacherId);
    for (var announcement in announcements) {
      await firestore.collection('announcements').doc(announcement.id).set(
        announcement.toJson(),
      );
    }
  }
  
  print('âœ… Migration complete!');
}
```

---

## âš ï¸ Best Practices

### 1. Use Batch Writes for Multiple Operations
```dart
final batch = FirebaseFirestore.instance.batch();
batch.set(docRef1, data1);
batch.update(docRef2, data2);
batch.delete(docRef3);
await batch.commit();
```

### 2. Implement Offline Persistence
```dart
FirebaseFirestore.instance.settings = const Settings(
  persistenceEnabled: true,
  cacheSizeBytes: Settings.CACHE_SIZE_UNLIMITED,
);
```

### 3. Use Transactions for Concurrent Updates
```dart
await FirebaseFirestore.instance.runTransaction((transaction) async {
  final snapshot = await transaction.get(docRef);
  final newCount = (snapshot.data()?['submittedCount'] ?? 0) + 1;
  transaction.update(docRef, {'submittedCount': newCount});
});
```

### 4. Paginate Large Collections
```dart
final firstPage = await FirebaseFirestore.instance
    .collection('assignments')
    .limit(20)
    .get();

final lastDoc = firstPage.docs.last;

final nextPage = await FirebaseFirestore.instance
    .collection('assignments')
    .startAfterDocument(lastDoc)
    .limit(20)
    .get();
```

---

## ğŸ§ª Testing Firestore Setup

### Test Checklist

- [ ] Firebase project created
- [ ] Firestore enabled in Firebase Console
- [ ] All 6 collections created
- [ ] Security rules published
- [ ] Composite indexes created and built
- [ ] Sample teacher data added
- [ ] Teacher login works with Firestore
- [ ] Can read classes from Firestore
- [ ] Can create assignments in Firestore
- [ ] Can record grades in Firestore
- [ ] Can create announcements in Firestore

---

## ğŸ“ Support & Resources

- **Firebase Documentation:** https://firebase.google.com/docs/firestore
- **Flutter Firebase:** https://firebase.flutter.dev/
- **Sample Data Reference:** [lib/services/sample_teacher_data.dart](lib/services/sample_teacher_data.dart)
- **Model Reference:** [lib/models/](lib/models/)
- **Firebase Console Setup:** [FIREBASE_CONSOLE_SETUP.md](FIREBASE_CONSOLE_SETUP.md)

---

## âœ… Summary

**Collections:** 6 (users, teachers, classes, assignments, grades, announcements)

**Total Fields:** ~60 fields across all collections

**Security:** Role-based access control (RBAC)

**Indexing:** 5 composite indexes for query optimization

**Authentication:** Firebase Auth + Firestore user profiles

**Migration Path:** Sample data â†’ Firestore (script provided)

---

**Last Updated:** February 11, 2026  
**Version:** 1.0  
**Status:** âœ… Complete & Ready for Implementation
